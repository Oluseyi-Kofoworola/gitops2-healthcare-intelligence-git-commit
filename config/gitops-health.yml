# GitOps Health Configuration Example
# Place this file at: ~/.gitops-health/config.yml or ./gitops-health.yml

# ============================================================================
# Project Configuration
# ============================================================================
project:
  name: healthcare-platform
  description: HIPAA-compliant healthcare engineering platform
  
  # Compliance frameworks to enforce
  compliance_frameworks:
    - HIPAA                  # Health Insurance Portability and Accountability Act
    - FDA_21_CFR_PART_11    # Medical device software regulations
    - SOX                    # Sarbanes-Oxley Act (if applicable)
  
  # Repository settings
  repository:
    default_branch: main
    protected_branches:
      - main
      - production
      - release/*

# ============================================================================
# Risk Scoring Configuration
# ============================================================================
risk:
  # Risk level thresholds
  thresholds:
    low: 
      min: 0.0
      max: 3.0
    medium:
      min: 3.1
      max: 6.0
    high:
      min: 6.1
      max: 8.0
    critical:
      min: 8.1
      max: 10.0
  
  # Critical paths that trigger higher risk scores
  critical_paths:
    - path: "services/payment-gateway/"
      weight: 1.5
      reason: "SOX financial controls"
    
    - path: "services/phi-service/"
      weight: 2.0
      reason: "Protected Health Information (HIPAA)"
    
    - path: "services/auth-service/"
      weight: 1.3
      reason: "Authentication and access control"
    
    - path: "services/medical-device/"
      weight: 1.8
      reason: "FDA-regulated medical device software"
  
  # Semantic commit type weights
  semantic_weights:
    feat: 3.0        # New features
    fix: 2.0         # Bug fixes
    security: 6.0    # Security patches (high priority)
    refactor: 2.5    # Code refactoring
    perf: 3.5        # Performance improvements
    docs: 0.5        # Documentation only
    test: 1.0        # Test additions
    chore: 1.0       # Maintenance tasks
    style: 0.5       # Code style changes
  
  # Deployment strategy mapping
  deployment_strategies:
    low: rolling-update
    medium: canary
    high: blue-green
    critical: blue-green-with-approval
  
  # Approval requirements by risk level
  approval_requirements:
    low:
      required: 1
      teams: ["engineering"]
    medium:
      required: 1
      teams: ["engineering", "security"]
    high:
      required: 2
      teams: ["engineering", "security", "compliance"]
    critical:
      required: 3
      teams: ["engineering", "security", "compliance", "executive"]

# ============================================================================
# Commit Generation Configuration
# ============================================================================
commit:
  # Conventional commits format enforcement
  conventional_commits:
    enabled: true
    allowed_types:
      - feat
      - fix
      - docs
      - style
      - refactor
      - perf
      - test
      - build
      - ci
      - chore
      - revert
      - security
  
  # Required metadata for healthcare compliance
  required_metadata:
    - HIPAA-ADMIN          # Does this change touch PHI administrative data?
    - FDA-SOFTWARE         # Is this medical device software?
    - SOX-FINANCIAL        # Does this affect financial controls?
    - RISK-LEVEL           # What's the risk level?
  
  # Auto-suggest reviewers based on files changed
  reviewer_mapping:
    "services/payment-gateway/":
      - "@security-team"
      - "@finance-team"
    
    "services/phi-service/":
      - "@security-team"
      - "@compliance-team"
      - "@hipaa-officers"
    
    "services/medical-device/":
      - "@security-team"
      - "@compliance-team"
      - "@fda-validation-team"
    
    "policies/":
      - "@compliance-team"
      - "@security-team"
  
  # Commit message templates
  templates:
    security:
      prefix: "security"
      guidelines: |
        - Describe the security vulnerability fixed
        - Include CVE number if applicable
        - Note patient safety impact
        - Document testing performed
    
    hipaa:
      prefix: "feat|fix|refactor"
      guidelines: |
        - Specify PHI data types affected
        - Note encryption/access control changes
        - Include audit trail impact
        - Reference HIPAA safeguard requirements

# ============================================================================
# Compliance Configuration
# ============================================================================
compliance:
  # OPA policy settings
  opa:
    policy_directory: ./policies
    strict_mode: true
    fail_on_warnings: false
    
    # Policy namespaces to evaluate
    namespaces:
      - healthcare.hipaa
      - healthcare.fda
      - healthcare.sox
      - enterprise.commit
  
  # PHI detection patterns
  phi_detection:
    enabled: true
    patterns:
      # Common PHI field names
      - "patient_name"
      - "patient_id"
      - "ssn"
      - "social_security"
      - "date_of_birth"
      - "dob"
      - "medical_record_number"
      - "mrn"
      - "diagnosis"
      - "prescription"
      - "lab_result"
      
      # File patterns
      - "**/patient*.sql"
      - "**/phi*.json"
      - "**/medical_record*"
    
    # Excluded paths (test data, documentation)
    exclude_paths:
      - "tests/fixtures/"
      - "docs/examples/"
      - "**/synthetic_*.json"
  
  # Compliance reporting
  reporting:
    enabled: true
    output_formats:
      - json
      - html
      - pdf
    
    retention_days: 2555  # 7 years (HIPAA requirement)
    
    # Audit log configuration
    audit_log:
      enabled: true
      destination: ./audit-logs/
      format: json
      include_metadata: true

# ============================================================================
# AI Configuration
# ============================================================================
ai:
  # AI provider settings
  provider: openai  # Options: openai, azure-openai, anthropic, local
  
  # OpenAI settings
  openai:
    api_key: ${OPENAI_API_KEY}  # Use environment variable
    model: gpt-4
    temperature: 0.3
    max_tokens: 1000
    timeout: 30
  
  # Azure OpenAI settings (alternative)
  azure_openai:
    api_key: ${AZURE_OPENAI_API_KEY}
    endpoint: ${AZURE_OPENAI_ENDPOINT}
    deployment_name: gpt-4
    api_version: "2024-02-01"
  
  # Anthropic settings (alternative)
  anthropic:
    api_key: ${ANTHROPIC_API_KEY}
    model: claude-3-opus-20240229
    max_tokens: 1000
  
  # Prompt engineering settings
  prompts:
    commit_generation:
      system_prompt: |
        You are a healthcare compliance expert helping engineers write
        compliant commit messages for HIPAA, FDA, and SOX regulated systems.
        
        Generate commit messages following Conventional Commits format with
        required healthcare metadata.
      
      user_prompt_template: |
        Generate a commit message for these changes:
        
        Type: {commit_type}
        Scope: {scope}
        Description: {description}
        
        Files changed: {files}
        Lines added: {lines_added}
        Lines deleted: {lines_deleted}
        
        Include:
        - Conventional Commits format
        - Healthcare compliance metadata (HIPAA, FDA, SOX)
        - Business impact statement
        - Testing evidence
        - Risk assessment
  
  # Rate limiting and caching
  rate_limiting:
    enabled: true
    max_requests_per_minute: 20
  
  caching:
    enabled: true
    ttl_seconds: 3600

# ============================================================================
# Forensics Configuration
# ============================================================================
forensics:
  # Intelligent git bisect settings
  bisect:
    max_steps: 20
    timeout_per_step: 300  # seconds
    
    # Health check configurations
    health_checks:
      latency:
        metric: response_time_ms
        threshold: 200
        direction: less_than
      
      error_rate:
        metric: error_percentage
        threshold: 0.05
        direction: less_than
      
      availability:
        metric: uptime_percentage
        threshold: 99.9
        direction: greater_than
  
  # Incident response automation
  incident_response:
    enabled: true
    auto_create_issues: true
    issue_labels:
      - incident
      - automated
      - needs-review
    
    # Notification channels
    notifications:
      slack:
        enabled: true
        webhook_url: ${SLACK_WEBHOOK_URL}
        channel: "#incidents"
      
      pagerduty:
        enabled: false
        integration_key: ${PAGERDUTY_KEY}
      
      email:
        enabled: true
        recipients:
          - oncall@example.com
          - compliance@example.com

# ============================================================================
# Logging Configuration
# ============================================================================
logging:
  level: INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: json
  
  # Structured logging fields
  include_fields:
    - timestamp
    - level
    - message
    - correlation_id
    - user
    - commit_sha
    - framework
    - risk_level
  
  # Log destinations
  handlers:
    - type: console
      level: INFO
    
    - type: file
      level: DEBUG
      path: ~/.gitops-health/logs/gitops-health.log
      rotation: daily
      retention_days: 30
    
    - type: syslog
      enabled: false
      host: logs.example.com
      port: 514

# ============================================================================
# Integration Configuration
# ============================================================================
integrations:
  # GitHub integration
  github:
    enabled: true
    token: ${GITHUB_TOKEN}
    api_url: https://api.github.com
    
    # Auto-label PRs based on risk
    auto_label: true
    label_mapping:
      low: "risk:low"
      medium: "risk:medium"
      high: "risk:high"
      critical: "risk:critical"
  
  # Jira integration (optional)
  jira:
    enabled: false
    url: ${JIRA_URL}
    username: ${JIRA_USERNAME}
    api_token: ${JIRA_API_TOKEN}
    project_key: HEALTH
  
  # Datadog integration (optional)
  datadog:
    enabled: false
    api_key: ${DATADOG_API_KEY}
    app_key: ${DATADOG_APP_KEY}
  
  # AWS integration (optional)
  aws:
    enabled: false
    region: us-east-1
    
    # S3 for audit logs
    s3:
      bucket: gitops-health-audit-logs
      prefix: compliance/
    
    # KMS for encryption
    kms:
      key_id: ${AWS_KMS_KEY_ID}

# ============================================================================
# Performance Configuration
# ============================================================================
performance:
  # Caching
  cache:
    enabled: true
    backend: file  # Options: file, redis, memcached
    ttl: 3600
    directory: ~/.gitops-health/cache/
  
  # Parallel processing
  parallel:
    enabled: true
    max_workers: 4
  
  # Timeouts
  timeouts:
    git_operations: 30
    opa_evaluation: 10
    ai_requests: 30

# ============================================================================
# Security Configuration
# ============================================================================
security:
  # Secrets detection
  secrets_detection:
    enabled: true
    patterns:
      - api[_-]?key
      - secret[_-]?key
      - password
      - token
      - private[_-]?key
    
    exclude_patterns:
      - "example"
      - "dummy"
      - "test"
  
  # Encryption
  encryption:
    enabled: true
    algorithm: AES-256-GCM
    key_rotation_days: 90
