global:
  resolve_timeout: 5m
  pagerduty_url: 'https://events.pagerduty.com/v2/enqueue'
  slack_api_url: 'YOUR_SLACK_WEBHOOK_URL'

# Templates for alert messages
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# Main routing tree
route:
  group_by: ['alertname', 'service', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'default'
  
  routes:
    # Critical alerts -> PagerDuty (page on-call)
    - match:
        severity: critical
      receiver: 'pagerduty-critical'
      continue: true
      routes:
        # Also send to Slack for visibility
        - receiver: 'slack-critical'
          continue: false
    
    # Warning alerts -> Slack only (no page)
    - match:
        severity: warning
      receiver: 'slack-warnings'
      group_wait: 2m
      group_interval: 10m
    
    # Info alerts -> Slack (low priority channel)
    - match:
        severity: info
      receiver: 'slack-info'
      group_wait: 5m
      group_interval: 30m
      repeat_interval: 12h
    
    # Cost alerts -> Finance team
    - match_re:
        alertname: '.*Cost.*'
      receiver: 'slack-finance'
    
    # Compliance alerts -> Compliance team
    - match:
        team: compliance
      receiver: 'slack-compliance'
      continue: true

# Inhibition rules (suppress alerts when other alerts are firing)
inhibit_rules:
  # Suppress all alerts for a service if it's down
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.*'
    equal: ['service', 'instance']
  
  # Suppress warning alerts if critical alert is firing
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['service']
  
  # Suppress HighMemoryUsage if service is restarting
  - source_match:
      alertname: 'ServiceRestarted'
    target_match:
      alertname: 'HighMemoryUsage'
    equal: ['service', 'instance']

# Receivers (notification channels)
receivers:
  # Default receiver (fallback)
  - name: 'default'
    slack_configs:
      - channel: '#alerts-default'
        title: '{{ .CommonAnnotations.summary }}'
        text: '{{ .CommonAnnotations.description }}'
        send_resolved: true
  
  # PagerDuty for critical alerts
  - name: 'pagerduty-critical'
    pagerduty_configs:
      - service_key: 'YOUR_PAGERDUTY_INTEGRATION_KEY'
        description: '{{ .CommonAnnotations.summary }}'
        severity: '{{ .CommonLabels.pagerduty_priority | default "error" }}'
        details:
          firing: '{{ .Alerts.Firing | len }}'
          resolved: '{{ .Alerts.Resolved | len }}'
          service: '{{ .CommonLabels.service }}'
          runbook_url: '{{ .CommonAnnotations.runbook_url }}'
        client: 'Healthcare GitOps Alertmanager'
        client_url: 'https://alertmanager.healthcare-gitops.com'
  
  # Slack for critical alerts
  - name: 'slack-critical'
    slack_configs:
      - channel: '#alerts-critical'
        color: 'danger'
        title: 'üö® CRITICAL: {{ .CommonAnnotations.summary }}'
        title_link: '{{ .CommonAnnotations.runbook_url }}'
        text: |
          {{ .CommonAnnotations.description }}
          
          *Service:* {{ .CommonLabels.service }}
          *Severity:* {{ .CommonLabels.severity }}
          *Runbook:* {{ .CommonAnnotations.runbook_url }}
        send_resolved: true
        actions:
          - type: button
            text: 'View Runbook'
            url: '{{ .CommonAnnotations.runbook_url }}'
          - type: button
            text: 'View Grafana'
            url: 'https://grafana.healthcare-gitops.com'
          - type: button
            text: 'Acknowledge'
            url: 'https://alertmanager.healthcare-gitops.com'
  
  # Slack for warnings
  - name: 'slack-warnings'
    slack_configs:
      - channel: '#alerts-warnings'
        color: 'warning'
        title: '‚ö†Ô∏è WARNING: {{ .CommonAnnotations.summary }}'
        text: |
          {{ .CommonAnnotations.description }}
          
          *Service:* {{ .CommonLabels.service }}
        send_resolved: true
  
  # Slack for info alerts
  - name: 'slack-info'
    slack_configs:
      - channel: '#alerts-info'
        color: 'good'
        title: '‚ÑπÔ∏è INFO: {{ .CommonAnnotations.summary }}'
        text: '{{ .CommonAnnotations.description }}'
        send_resolved: false
  
  # Slack for finance/cost alerts
  - name: 'slack-finance'
    slack_configs:
      - channel: '#alerts-finance'
        color: '#FFD700'
        title: 'üí∞ COST ALERT: {{ .CommonAnnotations.summary }}'
        text: |
          {{ .CommonAnnotations.description }}
          
          Please review cost optimization opportunities.
        send_resolved: true
  
  # Slack for compliance alerts
  - name: 'slack-compliance'
    slack_configs:
      - channel: '#alerts-compliance'
        color: '#800080'
        title: 'üìã COMPLIANCE: {{ .CommonAnnotations.summary }}'
        text: |
          {{ .CommonAnnotations.description }}
          
          *Team:* {{ .CommonLabels.team }}
          *Runbook:* {{ .CommonAnnotations.runbook_url }}
        send_resolved: true

# Time-based muting (maintenance windows)
# Example: Mute alerts during scheduled maintenance
# time_intervals:
#   - name: 'maintenance-window'
#     time_intervals:
#       - times:
#           - start_time: '02:00'
#             end_time: '04:00'
#         weekdays: ['saturday', 'sunday']
